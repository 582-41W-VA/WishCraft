{% extends "app/base.html" %}
{% load static %}
{% block content %}
	<h1>Admin panel</h1>
	<h2>User detail</h2>

	<a href="{% url 'user_list' %}">Go back to the list</a>

	<h3>Username: {{ user.username }}</h3>
	
	<h3>Email: {{ user.email }}</h3>

	<form id="deleteUser" method="post" action="{% url 'user_delete' pk=user.pk %}">
		{% csrf_token %}	
		<a href="{% url 'user_edit' pk=user.pk %}">Edit</a>
		<input type="submit" value="Delete">
	</form>

	<!-- Delete user confirmation -->
  	<script>
		document.getElementById('deleteUser').addEventListener('submit', function(event) {
			 if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
				  event.preventDefault();
			 }
		});
  </script>

	<h2>User Cards</h2>

	<div class="total-cards">
		<h3>Total number of cards: {{ cards.count }}</h3>
	</div>

	{% for card in cards %}
	<article>
		<h4>{{ card.title}}</h4>

		{% if card.image %}
        <img src="{{ card.image.url }}" alt="{{ card.title }}" width="100px" />
		{% endif %}

		<p>{{ card.likes }} likes</p>

		<ul>Tags: 
			{% for tag in card.tag.all %} 
			<li>{{ tag.name }}</li>
			{% endfor %}
		</ul>

		<p>Created on {{ card.date_created }}</p>

		<form class="deleteCard" method="post" action="{% url 'card_delete' pk=card.pk %}">
			{% csrf_token %}
			<a href="{% url 'card_edit' pk=card.pk %}">Edit</a>
			<input type="submit" value="Delete">
		</form>
	</article>

	{% endfor %}

	<!-- Delete card confirmation -->
	<script>
		let deleteForm = document.querySelectorAll('.deleteCard');
		deleteForm.forEach(function(form) {
			form.addEventListener('submit', function(event) {
				if (!confirm('Are you sure you want to delete this card? This action cannot be undone.')) {
						event.preventDefault();
				}
			});
		});
  </script>

{% endblock %}